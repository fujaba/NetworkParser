package de.unikassel.synergybox.database;

import java.io.Serializable;

import org.hibernate.Session;
import org.sdmlib.serialization.SimpleIdCounter;

import de.SynergyBox.model.SynergyBoxEntity;
import de.unikassel.synergybox.core.SynergyBox;

public class SynergyBoxCounter extends SimpleIdCounter
{
	
	private Session session;

	public SynergyBoxCounter(SynergyBox synergyBox)
	{

		session = synergyBox.getCurrentSession();
	}

	@Override
	public String getId(Object obj)
	{
		if (obj instanceof SynergyBoxEntity)
		{
			SynergyBoxEntity entity = (SynergyBoxEntity) obj;
			final Integer id = entity.getId();
			
			String key;
			if (id == null)
			{
				final Serializable save = session.save(obj);
				key = save.toString();
			} else {
				key = id.toString();
			}
			return this.getPrefixId()+this.getSplitter()+obj.getClass().getSimpleName() + this.getSplitter() + key;
		}
		return super.getId(obj);
	}

}
